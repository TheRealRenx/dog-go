<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Solicitud</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: url('conejo1.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Segoe UI', sans-serif;
        }

        .container {
            max-width: 700px;
            margin: 40px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .form-section {
            margin-bottom: 30px;
        }

        textarea {
            resize: vertical;
        }

        h2 {
            color: #2c3e50;
        }

        h5 {
            color: #117a8b;
            border-bottom: 2px solid #17a2b8;
            padding-bottom: 5px;
            margin-bottom: 20px;
        }

        label {
            color: #495057;
        }

        .btn-primary {
            background-color: #17a2b8;
            border: none;
        }

        .btn-primary:hover {
            background-color: #138496;
        }

        .btn-success {
            background-color: #28a745;
            border: none;
        }

        .btn-success:hover {
            background-color: #218838;
        }
    </style>
</head>

<body>
    <div id="menu-container"></div>
    <div class="container">
        <h2 class="mb-4">Formulario de Solicitud de Cuidado de Mascotas</h2>

        <div class="form-section">
            <h5>Datos del Solicitante</h5>
            <form id="solicitud-form">
                <div class="mb-3">
                    <label for="nombres" class="form-label">Nombres y Apellidos</label>
                    <input type="text" id="nombres" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="edad" class="form-label">Edad</label>
                    <input type="number" id="edad" class="form-control" min="0" required>
                </div>
                <div class="mb-3">
                    <label for="ciudad" class="form-label">Ciudad</label>
                    <input type="text" id="ciudad" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="domicilio" class="form-label">Domicilio</label>
                    <input type="text" id="domicilio" class="form-control" required>
                </div>

                <hr>

                <h5>Información de la Mascota</h5>
                <div class="mb-3">
                    <label for="foto" class="form-label">Foto de la Mascota</label>
                    <input type="file" id="foto" class="form-control" accept="image/*">
                </div>
                <div class="mb-3">
                    <label for="nombreMascota" class="form-label">Nombre</label>
                    <input type="text" id="nombreMascota" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="edadMascota" class="form-label">Edad</label>
                    <input type="number" id="edadMascota" class="form-control" min="0" required>
                </div>
                <div class="mb-3">
                    <label for="tipoMascota" class="form-label">Tipo</label>
                    <input type="text" id="tipoMascota" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label for="razaMascota" class="form-label">Raza</label>
                    <input type="text" id="razaMascota" class="form-control">
                </div>
                <div class="mb-3">
                    <label for="condicionMascota" class="form-label">Condición / Observaciones</label>
                    <textarea id="condicionMascota" class="form-control" rows="3"></textarea>
                </div>

                <div class="d-flex justify-content-between">
                    <button type="submit" class="btn btn-primary">Registrar</button>
                    <a href="listSolicitantes.html" class="btn btn-success">Ver datos guardados</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.getElementById('solicitud-form').addEventListener('submit', function (e) {
            e.preventDefault(); // Evita el envío tradicional del formulario

            const imageFile = document.getElementById('foto').files[0];

            if (imageFile) {
                const reader = new FileReader();

                reader.onload = function(event) {
                    const imageData = event.target.result; // La imagen en Base64

                    // Recopila los demás datos del formulario
                    const nuevoRegistro = {
                        nombres: document.getElementById('nombres').value,
                        edad: document.getElementById('edad').value,
                        ciudad: document.getElementById('ciudad').value,
                        domicilio: document.getElementById('domicilio').value,
                        mascota: {
                            foto: imageData, // Aquí se guarda la imagen Base64
                            nombre: document.getElementById('nombreMascota').value,
                            edad: document.getElementById('edadMascota').value,
                            tipo: document.getElementById('tipoMascota').value,
                            raza: document.getElementById('razaMascota').value,
                            condicion: document.getElementById('condicionMascota').value
                        }
                    };

                    saveToLocalStorage(nuevoRegistro);
                };

                reader.onerror = function(error) {
                    alert('Error al leer la imagen: ' + error.message);
                };

                reader.readAsDataURL(imageFile); // Lee el archivo como Base64
            } else {
                // Si no hay imagen, guarda los datos sin ella o con un valor predeterminado
                const nuevoRegistro = {
                    nombres: document.getElementById('nombres').value,
                    edad: document.getElementById('edad').value,
                    ciudad: document.getElementById('ciudad').value,
                    domicilio: document.getElementById('domicilio').value,
                    mascota: {
                        foto: null, // O un placeholder de imagen si no se selecciona ninguna
                        nombre: document.getElementById('nombreMascota').value,
                        edad: document.getElementById('edadMascota').value,
                        tipo: document.getElementById('tipoMascota').value,
                        raza: document.getElementById('razaMascota').value,
                        condicion: document.getElementById('condicionMascota').value
                    }
                };
                saveToLocalStorage(nuevoRegistro);
            }
        });

        function saveToLocalStorage(registro) {
            let registros = JSON.parse(localStorage.getItem('solicitudesCuidadoMascota')) || [];
            registros.push(registro);
            
            try {
                localStorage.setItem('solicitudesCuidadoMascota', JSON.stringify(registros));
                alert('Datos registrados correctamente.');
                document.getElementById('solicitud-form').reset(); // Limpia el formulario
            } catch (e) {
                alert('Error al guardar en el almacenamiento local: ' + e.message + '\nEs posible que el almacenamiento esté lleno.');
            }
        }
    </script>
    <script src="script.js"></script>
</body>

</html>